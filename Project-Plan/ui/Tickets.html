<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="Styling.css">
    <style>
        /* table.center{
            
        } */
    </style>
    <!-- <meta charset="UTF-8"> -->
    <title>View Tickets</title>
</head>
<body>
    <h1>View Tickets</h1>
    <form id="idEntry">
    <!-- <form method= "POST" action="http://localhost:8080/Project-1/tickets"> -->
        Enter User ID: <input name="user_id" type="number" id="userID" required placeholder="User ID" /> 
    <input type="submit" onclick={retrieveTickets()} value="Enter">
    </form>

    <br><br><br>
    <table class="table table-responsive">
        <thead>
            <tr>
                <th>Ticket ID</th>
                <th>Flight #</th>
                <th>User ID</th>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Check-In</th>
                <th>Cancel</th>
            </tr>
        </thead>
           <tbody id="TicketTable">
           </tbody>
   </table>
   <br><br><br>
   <form id="checkIn" method="POST" action="http://localhost:8080/Project-1/tickets">
        Enter Ticket ID: <input name="ticket_id" type="number" id="ticketId" required placeholder="Ticket ID"/>
        <input type="submit" value="Check In">
        <input type="submit" value="Cancel">
    
    <script>
        async function retrieveTickets() {
            let submission = document.getElementById("idEntry");
            let body = {
            user_id: submission
        };
            let response = await fetch("http://localhost:8080/Project-1/tickets", {
            method: 'POST',
            body: JSON.stringify(body)
        });
            let json = await response.json();
            let table = document.getElementById("TicketTable");
                for (let element of json) { 
                let tr = table.insertRow(-1);
                /*
                Here include logic that  "explodes" the "element" of json, 
                and prepare an object that has only the fields that are 
                about to be mapped into the table below.
                */
                // let {ticket_id, user:{user_id}, flight:{flight_num}, first_name, last_name, checkIn, cancel} = tableEntry;
                for (let key in element) {
                    let cell = tr.insertCell(-1);
                    if (key === "user"){
                        for (let key2 in element[key]){
                            if (key2 === "user_id"){
                                cell.innerHTML = element[key][key2];
                            }
                        }
                    } else if (key === "flight"){
                        for (let key2 in element[key]){
                            if (key2 === "flight_num"){
                                cell.innerHTML = element[key][key2];
                            }
                        }
                    // } else if (key === "checkIn" || key === "cancel"){
                    //     let check = cell.createElement("INPUT");
                    //     cell.setAttribute("type", "checkbox");
                    // } 
                    } else {
                        cell.innerHTML = element[key];
                    }
                }
            }
        };
    </script>
</body>
</html>